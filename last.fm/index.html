<!DOCTYPE html>
<html lang="es-MX">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last.fm Live Cover</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background-color: #000; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            overflow: hidden;
        }
        img { 
            max-width: 100%; 
            max-height: 100vh; 
            object-fit: contain; 
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            opacity: 0; /* Invisible al inicio para efecto fade */
            transition: opacity 0.5s ease-in-out;
        }
        img.loaded {
            opacity: 1;
        }
    </style>
</head>
<body>

    <img id="coverArt" src="" alt="Cargando...">

    <script>
        const USER = 'camoril';
        const API_KEY = '7a67bfe297bfe43956a01cab95dfc965';
        const IMG_ELEMENT = document.getElementById('coverArt');
        let currentImageUrl = '';

        async function updateCover() {
            try {
                // 1. Obtener canciones recientes (formato JSON)
                const response = await fetch(`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${USER}&api_key=${API_KEY}&format=json&limit=1`);
                const data = await response.json();
                
                if (!data.recenttracks || !data.recenttracks.track) return;

                const track = data.recenttracks.track[0];
                // Intentar obtener imagen extralarge (índice 3)
                let newImageUrl = track.image[3]['#text'];

                // 2. Si no hay portada, buscar imagen del artista
                if (!newImageUrl) {
                    const artist = encodeURIComponent(track.artist['#text']);
                    const artistResp = await fetch(`https://ws.audioscrobbler.com/2.0/?method=artist.getinfo&artist=${artist}&api_key=${API_KEY}&format=json`);
                    const artistData = await artistResp.json();
                    
                    if (artistData.artist && artistData.artist.image) {
                        // Intentar obtener imagen mega (índice 4) o extralarge (3)
                        newImageUrl = artistData.artist.image[4]['#text'] || artistData.artist.image[3]['#text'];
                    }
                }

                // Solo actualizar si la imagen cambió y no está vacía
                if (newImageUrl && newImageUrl !== currentImageUrl) {
                    currentImageUrl = newImageUrl;
                    
                    // Precargar imagen para evitar parpadeos
                    const tempImg = new Image();
                    tempImg.onload = () => {
                        IMG_ELEMENT.src = newImageUrl;
                        IMG_ELEMENT.classList.add('loaded');
                    };
                    tempImg.src = newImageUrl;
                }

            } catch (error) {
                console.error('Error al obtener datos de Last.fm:', error);
            }
        }

        // Actualizar inmediatamente y luego cada 10 segundos
        updateCover();
        setInterval(updateCover, 10000);
    </script>
</body>
</html>